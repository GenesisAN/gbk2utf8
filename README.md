# GBK转UTF-8批量转换工具

一个命令行工具，用于扫描目录下的 `.c/.h`（或自定义扩展名）文件，检测是否为 GBK 编码的中文文本，并可按条件批量转换为 UTF-8 编码，也可通过`-e`参数配置支持其他格式文件。

---

## 支持功能

- 🔍 扫描目录下符合条件的源文件
- ✅ 支持判断中文字符总数与连续字符数
- 🧪 支持“仅扫描”模式，避免误操作
- 📦 支持转换前自动备份原文件
- 🧾 支持多扩展名自定义检测
- 🗣️ 命令行输出详细信息（可选）

---

## 🛠️ 构建方法

确保已安装 [Rust 环境](https://www.rust-lang.org/zh-CN/tools/install)。

```bash
cargo build --release
````

构建完成后，二进制文件在 `target/release/` 目录下。

---

## 🚀 使用方法

```bash
gbk2utf8 [选项]
```

如果你没有修改程序名称，默认执行路径为：

```bash
./target/release/gbk2utf8
```

---

## ⚙️ 命令行参数说明

| 参数                       | 简写   | 默认值   | 说明                            |
| ------------------------ | ---- | ----- | ----------------------------- |
| `--dir <路径>`             | `-d` | `./`  | 要扫描的目录                        |
| `--threshold <数字>`       | `-t` | `4`   | 至少包含多少个中文字符才进行转换              |
| `--min-consecutive <数字>` | `-m` | `2`   | 要求的最小连续中文字符数                  |
| `--scan-only`            | `-s` |       | 启用扫描模式，仅检测不转换                 |
| `--backup`               | `-b` |       | 转换前备份原始文件（`.bak`）             |
| `--show-info`            | `-i` |       | 显示详细的处理信息                     |
| `--extensions <扩展名列表>`   | `-e` | `c,h` | 要检查的文件扩展名，多个用逗号分隔，如：`c,h,cpp` |
| `--version`              | `-v` |       | 显示版本信息                        |
| `--help`                 |      |       | 显示帮助信息                        |

---

## 📌 使用示例

### ✅ 扫描当前目录下的 `.c` / `.h` 文件，显示详细信息但不修改：

```bash
gbk2utf8 -s -i
```

### ✅ 扫描并转换包含 ≥5 个中文字符、且 ≥3 个连续中文字符的文件，并在转换前备份：

```bash
gbk2utf8 -t 5 -m 3 -b -i
```

### ✅ 扫描 `src` 目录，检测 `.c`, `.h`, `.cpp` 文件扩展名：

```bash
gbk2utf8 -d ./src -e c,h,cpp -i
```

---

## 🧱 依赖库

* [`clap`](https://docs.rs/clap/)：命令行参数解析
* [`encoding`](https://docs.rs/encoding/)：处理 GBK 解码
* 标准库：文件处理、遍历、IO 等


## 🙋 常见问题

**Q: 会误伤 UTF-8 吗？**
A: 不会。程序会优先判断文件是否为合法 UTF-8 编码并包含中文，若是则跳过。

**Q: 支持递归子目录吗？**
A: 支持。会自动遍历指定目录及其子目录。

---
