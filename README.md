GBK 转 UTF-8 批量转换工具（带筛选）
日常开发中经常遇到旧代码中混杂 GBK 编码的 .c/.h 文件，尤其在 Windows 和 Linux 间切换时，编码问题容易导致中文注释乱码。市面上的转换工具大多是“全盘替换”，经常把本来就是 UTF-8 或纯英文的文件也改了，反而带来更多麻烦。

于是写了这个简单的命令行工具，只处理真正含 GBK 中文的文件，避免误伤，用起来更安心。

功能特点


🔍 支持“仅扫描”模式：先看哪些文件会被转，避免误操作

🗂️ 

💾 转换前自动备份：原文件会备份为 .bak，可随时还原

🧾 命令行输出清晰：显示每个文件的检测/转换情况



## 支持功能
- 🧾 统计中文字符数量、连续中文字符长度，尽量判断是否真的是 GBK 中文
- 🔍 扫描目录下符合条件的源文件
- 🧪 支持“仅扫描”模式，避免误操作
- 📦 支持自动备份：使用`-b`参数原文件在转换前会备份为 .bak，可随时还原
- 🧾 支持多扩展名设置，默认处理 .c/.h 文件，可自定义其他格式
---

## 🛠️ 构建方法

确保已安装 [Rust 环境](https://www.rust-lang.org/zh-CN/tools/install)。

```bash
cargo build --release
````

构建完成后，二进制文件在 `target/release/` 目录下。

---

## 🚀 使用方法

```bash
gbk2utf8 [选项]
```

如果你没有修改程序名称，默认执行路径为：

```bash
./target/release/gbk2utf8
```

---

## ⚙️ 命令行参数说明

| 参数名                 | 简写   | 类型            | 默认值          | 是否必需 | 功能说明                                                                    |
| ------------------- | ---- | ------------- | ------------ | ---- | ----------------------------------------------------------------------- |
| `--dir`             | `-d` | `String`      | `./`         | 否    | **要扫描的目录路径**。程序会递归扫描该目录下的所有子目录。                                         |
| `--threshold`       | `-t` | `usize`       | `4`          | 否    | **文件中匹配的 GBK 中文字符总数需达到此值才会进行转换**。中文字符是指符合 GBK 中文编码范围的字节对。               |
| `--min-consecutive` | `-m` | `usize`       | `2`          | 否    | **文件中最长连续 GBK 中文字符的数量需达到此值才会转换**。主要用于避免误判一些非文本内容。                       |
| `--scan-only`       | `-s` | `bool`        | `false`      | 否    | **仅检测，不执行转换**。启用该选项时，只会打印符合条件的文件列表，不会修改文件内容。                            |
| `--backup`          | `-b` | `bool`        | `false`      | 否    | **转换前自动备份原始文件**。备份文件将以 `.bak` 作为后缀，例如 `example.c` 会备份为 `example.c.bak`。 |
| `--show-info`       | `-i` | `bool`        | `false`      | 否    | **打印详细处理信息**。包括每个文件的中文字符统计、是否跳过或转换等。                                    |
| `--extensions`      | `-e` | `Vec<String>` | `["c", "h"]` | 否    | **指定要处理的文件扩展名列表**，多个扩展名使用逗号分隔。例如：`-e c,h,cpp`。匹配时不区分大小写。                |
| `--version`         | `-v` | --            | --           | 否    | **显示程序版本号并退出**。该参数由 `clap` 自动提供。                                        |
| `--help`            |      | --            | --           | 否    | **显示帮助信息**，打印所有参数说明。由 `clap` 自动提供。                                      |


---

## 📌 使用示例

### ✅ 扫描当前目录下的 `.c` / `.h` 文件，显示详细信息但不修改：

```bash
gbk2utf8 -s -i
```

### ✅ 扫描并转换包含 ≥5 个中文字符、且 ≥3 个连续中文字符的文件，并在转换前备份：

```bash
gbk2utf8 -t 5 -m 3 -b -i
```

### ✅ 扫描 `src` 目录，检测 `.c`, `.h`, `.cpp` 文件扩展名：

```bash
gbk2utf8 -d ./src -e c,h,cpp -i
```

---

## 🧱 依赖库

* [`clap`](https://docs.rs/clap/)：命令行参数解析
* [`encoding`](https://docs.rs/encoding/)：处理 GBK 解码
* 标准库：文件处理、遍历、IO 等


## 🙋 常见问题

**Q: 会误伤 UTF-8 吗？**
A: 不会。程序会优先判断文件是否为合法 UTF-8 编码并包含中文，若是则跳过。

**Q: 支持递归子目录吗？**
A: 支持。会自动遍历指定目录及其子目录。

---
